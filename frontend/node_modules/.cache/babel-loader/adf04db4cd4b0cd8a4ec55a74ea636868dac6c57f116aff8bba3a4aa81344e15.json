{"ast":null,"code":"// src/components/LoginForm.jsx\nimport React,{useState}from\"react\";import NavBar from\"./NavBar\";import{TextField,Button,Box,Container,Typography,Link,IconButton,InputAdornment,Alert}from'@mui/material';import{Visibility,VisibilityOff}from'@mui/icons-material';import{useNavigate}from'react-router-dom';import axios from'axios';import{useAuth}from'../AuthContext';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function LoginForm(){const navigate=useNavigate();const{login,logout}=useAuth();const[formData,setFormData]=useState({username:'',password:''});const[errors,setErrors]=useState({username:'',password:'',general:''});const[showPassword,setShowPassword]=useState(false);const handleChange=e=>{const{name,value}=e.target;setFormData({...formData,[name]:value});};const handleFieldErrors=error=>{console.log(\"Error received:\",error);// 打印查看错误对象\nconst newErrors={username:'',password:'',general:''};if(error.response&&error.response.data&&error.response.data.error){const{message,code}=error.response.data.error;if(code==='USER_NOT_FOUND'){newErrors.username=message;}else if(code==='INVALID_PASSWORD'){newErrors.password=message;}else{newErrors.general=message;}}else{// 如果响应结构不如预期，给出一个通用错误消息\nnewErrors.general='Login failed due to server error.';}setErrors(newErrors);};const handleSubmit=event=>{event.preventDefault();const{username,password}=formData;// 清除错误状态\nsetErrors({username:'',password:'',general:''});// 验证字段\nif(!username||!password){const newErrors={};if(!username){newErrors.username='Username is required';}if(!password){newErrors.password='Password is required';}setErrors(newErrors);return;}// 发送登录请求\naxios.post('http://localhost:8000/api/login/',formData).then(response=>{const{access}=response.data;// 存储令牌\nlocalStorage.setItem('accessToken',access);const now=new Date();const expiryTime=now.getTime()+24*60*60*1000;// 当前时间加上24小时\nlocalStorage.setItem('tokenExpiry',expiryTime);// 使用登录方法传递访问令牌\nlogin(access);// 登录成功后跳转\nnavigate('/pipeline');// 更改为受保护的页面\n}).catch(error=>{handleFieldErrors(error);});};const handlePasswordResetClick=()=>{logout();// 确保在重置密码前清理状态\nnavigate('/passwordreset');};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NavBar,{}),/*#__PURE__*/_jsx(Container,{component:\"main\",maxWidth:\"xs\",children:/*#__PURE__*/_jsxs(Box,{sx:{position:'absolute',top:'40%',left:'50%',transform:'translate(-50%, -50%)',display:'flex',flexDirection:'column',alignItems:'center',width:'30vw'},children:[/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h5\",children:\"Login\"}),errors.general&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mt:1,mb:1},children:errors.general}),/*#__PURE__*/_jsxs(Box,{component:\"form\",onSubmit:handleSubmit,sx:{mt:1},children:[/*#__PURE__*/_jsx(TextField,{margin:\"normal\",required:true,fullWidth:true,id:\"username\",label:\"Username\",name:\"username\",autoComplete:\"username\",autoFocus:true,value:formData.username,onChange:handleChange,error:Boolean(errors.username),helperText:errors.username}),/*#__PURE__*/_jsx(TextField,{margin:\"normal\",required:true,fullWidth:true,name:\"password\",label:\"Password\",type:showPassword?'text':'password',id:\"password\",autoComplete:\"current-password\",value:formData.password,onChange:handleChange,error:Boolean(errors.password),helperText:errors.password,InputProps:{endAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"end\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>setShowPassword(!showPassword),onMouseDown:e=>e.preventDefault(),children:showPassword?/*#__PURE__*/_jsx(Visibility,{}):/*#__PURE__*/_jsx(VisibilityOff,{})})})}}),/*#__PURE__*/_jsx(Button,{type:\"submit\",fullWidth:true,variant:\"contained\",sx:{mt:3,mb:2,backgroundColor:'#6699cc'},children:\"Login\"}),/*#__PURE__*/_jsx(Link,{component:\"button\",variant:\"body2\",onClick:handlePasswordResetClick,sx:{mt:2},title:\"Reset your password here\",children:\"Forgot your password?\"})]})]})})]});}export default LoginForm;","map":{"version":3,"names":["React","useState","NavBar","TextField","Button","Box","Container","Typography","Link","IconButton","InputAdornment","Alert","Visibility","VisibilityOff","useNavigate","axios","useAuth","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LoginForm","navigate","login","logout","formData","setFormData","username","password","errors","setErrors","general","showPassword","setShowPassword","handleChange","e","name","value","target","handleFieldErrors","error","console","log","newErrors","response","data","message","code","handleSubmit","event","preventDefault","post","then","access","localStorage","setItem","now","Date","expiryTime","getTime","catch","handlePasswordResetClick","children","component","maxWidth","sx","position","top","left","transform","display","flexDirection","alignItems","width","variant","severity","mt","mb","onSubmit","margin","required","fullWidth","id","label","autoComplete","autoFocus","onChange","Boolean","helperText","type","InputProps","endAdornment","onClick","onMouseDown","backgroundColor","title"],"sources":["E:/宝可梦：无限融合/capstone-project-9900f14bravo/frontend/src/component/LoginForm.jsx"],"sourcesContent":["// src/components/LoginForm.jsx\nimport React, { useState } from \"react\";\nimport NavBar from \"./NavBar\";\nimport { TextField, Button, Box, Container, Typography, Link, IconButton, InputAdornment, Alert } from '@mui/material';\nimport { Visibility, VisibilityOff } from '@mui/icons-material';\nimport { useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { useAuth } from '../AuthContext';\n\nfunction LoginForm() {\n  const navigate = useNavigate();\n  const { login, logout } = useAuth();\n  const [formData, setFormData] = useState({ username: '', password: '' });\n  const [errors, setErrors] = useState({ username: '', password: '', general: '' });\n  const [showPassword, setShowPassword] = useState(false);\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    setFormData({ ...formData, [name]: value });\n  };\n\n  const handleFieldErrors = (error) => {\n    console.log(\"Error received:\", error); // 打印查看错误对象\n    const newErrors = { username: '', password: '', general: '' };\n    \n    if (error.response && error.response.data && error.response.data.error) {\n      const { message, code } = error.response.data.error;\n      \n      if (code === 'USER_NOT_FOUND') {\n        newErrors.username = message;\n      } else if (code === 'INVALID_PASSWORD') {\n        newErrors.password = message;\n      } else {\n        newErrors.general = message;\n      }\n    } else {\n      // 如果响应结构不如预期，给出一个通用错误消息\n      newErrors.general = 'Login failed due to server error.';\n    }\n    setErrors(newErrors);\n  };\n\n  const handleSubmit = (event) => {\n    event.preventDefault();\n    const { username, password } = formData;\n\n    // 清除错误状态\n    setErrors({ username: '', password: '', general: '' });\n\n    // 验证字段\n    if (!username || !password) {\n      const newErrors = {};\n      if (!username) {\n        newErrors.username = 'Username is required';\n      }\n      if (!password) {\n        newErrors.password = 'Password is required';\n      }\n      setErrors(newErrors);\n      return;\n    }\n\n    // 发送登录请求\n    axios.post('http://localhost:8000/api/login/', formData)\n      .then((response) => {\n        const { access } = response.data;\n        // 存储令牌\n        localStorage.setItem('accessToken', access);\n        const now = new Date();\n        const expiryTime = now.getTime() + 24 * 60 * 60 * 1000; // 当前时间加上24小时\n        localStorage.setItem('tokenExpiry', expiryTime);\n        // 使用登录方法传递访问令牌\n        login(access);\n        // 登录成功后跳转\n        navigate('/pipeline'); // 更改为受保护的页面\n      })\n      .catch((error) => {\n        handleFieldErrors(error);\n      });\n  };\n\n  const handlePasswordResetClick = () => {\n    logout(); // 确保在重置密码前清理状态\n    navigate('/passwordreset');\n  };\n\n  return (\n    <>\n      <NavBar />\n      <Container component=\"main\" maxWidth=\"xs\">\n        <Box\n          sx={{\n            position: 'absolute',\n            top: '40%',\n            left: '50%',\n            transform: 'translate(-50%, -50%)',\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            width: '30vw'\n          }}\n        >\n          <Typography component=\"h1\" variant=\"h5\">\n            Login\n          </Typography>\n          {errors.general && (\n            <Alert severity=\"error\" sx={{ mt: 1, mb: 1 }}>\n              {errors.general}\n            </Alert>\n          )}\n          <Box component=\"form\" onSubmit={handleSubmit} sx={{ mt: 1 }}>\n            <TextField\n              margin=\"normal\"\n              required\n              fullWidth\n              id=\"username\"\n              label=\"Username\"\n              name=\"username\"\n              autoComplete=\"username\"\n              autoFocus\n              value={formData.username}\n              onChange={handleChange}\n              error={Boolean(errors.username)}\n              helperText={errors.username}\n            />\n            <TextField\n              margin=\"normal\"\n              required\n              fullWidth\n              name=\"password\"\n              label=\"Password\"\n              type={showPassword ? 'text' : 'password'}\n              id=\"password\"\n              autoComplete=\"current-password\"\n              value={formData.password}\n              onChange={handleChange}\n              error={Boolean(errors.password)}\n              helperText={errors.password}\n              InputProps={{\n                endAdornment: (\n                  <InputAdornment position=\"end\">\n                    <IconButton\n                      onClick={() => setShowPassword(!showPassword)}\n                      onMouseDown={(e) => e.preventDefault()}\n                    >\n                      {showPassword ? <Visibility /> : <VisibilityOff />}\n                    </IconButton>\n                  </InputAdornment>\n                )\n              }}\n            />\n            <Button\n              type=\"submit\"\n              fullWidth\n              variant=\"contained\"\n              sx={{ mt: 3, mb: 2, backgroundColor: '#6699cc' }}\n            >\n              Login\n            </Button>\n            <Link\n              component=\"button\"\n              variant=\"body2\"\n              onClick={handlePasswordResetClick}\n              sx={{ mt: 2 }}\n              title=\"Reset your password here\"\n            >\n              Forgot your password?\n            </Link>\n          </Box>\n        </Box>\n      </Container>\n    </>\n  );\n}\n\nexport default LoginForm;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}